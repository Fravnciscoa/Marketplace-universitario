<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <div class="header-container">
      <!-- Logo -->
      <div class="header-logo">
        <img src="assets/icon/Escudo_PUCV-2016__Perfil Redes TW_FB.png" alt="PUCV Logo" />
        <span class="header-logo-text">MarketPlace</span>
      </div>

      <!-- Navegaci贸n -->
      <nav class="header-nav">
        <a routerLink="/home" class="nav-link nav-link--active">Inicio</a>
        <a routerLink="/categorias" class="nav-link">Categor铆as</a>
        <a routerLink="/carrito" class="nav-link">
          <ion-icon name="cart-outline"></ion-icon>
          Carrito
        </a>
      </nav>

      <!-- Botones de autenticaci贸n din谩micos -->
      <!-- Botones de autenticaci贸n din谩micos -->
      <div class="header-actions">
        <!-- Mostrar cuando NO est谩 logueado -->
        <ng-container *ngIf="!isLoggedIn">
          <ion-button routerLink="/auth" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="log-in-outline"></ion-icon>
            Iniciar Sesi贸n
          </ion-button>
          <ion-button routerLink="/auth" fill="solid" class="btn-auth btn-register">
            Registrarse
          </ion-button>
        </ng-container>

        <!-- Mostrar cuando S est谩 logueado -->
        <ng-container *ngIf="isLoggedIn">
          <!--  Bot贸n SOLO para ADMIN -->
          <ion-button
            *ngIf="isAdmin"
            routerLink="/admin-portal"
            fill="clear"
            class="btn-auth btn-login"
          >
            <ion-icon slot="start" name="settings-outline"></ion-icon>
            Panel Admin
          </ion-button>

          <ion-button routerLink="/publicar" fill="solid" class="btn-auth btn-publicar">
            <ion-icon slot="start" name="add-outline"></ion-icon>
            Publicar
          </ion-button>
          
          <ion-button routerLink="/perfil" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="person-outline"></ion-icon>
            Perfil
          </ion-button>

          <ion-button (click)="cerrarSesion()" fill="solid" class="btn-auth btn-logout">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            Cerrar Sesi贸n
          </ion-button>
        </ng-container>
      </div>

    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container">
    
    <!-- Secci贸n Hero -->
    <section class="hero-section">
      <div class="hero-content">
        <div class="hero-image">
          <img src="assets/shapes.svg" alt="Marketplace Universitario">
        </div>
        
        <div class="hero-search">
          <!-- Buscador -->
          <ion-searchbar
            [value]="terminoBusqueda"
            (ionInput)="onBusquedaChange($event)"
            placeholder="驴Qu茅 est谩s buscando?"
            animated
            search-icon="search-outline"
            class="custom-searchbar"
          >
          </ion-searchbar>
        </div>
      </div>
    </section>

    <!-- Secci贸n de Filtros -->
    <div class="filtros-header">
      <h3 class="filtros-titulo">Seccion filtros</h3>
    </div>

    <!-- Contenedor Principal: Filtros + Productos -->
    <div class="content-wrapper">
      
      <!-- Sidebar de Filtros -->
      <aside class="filtros-sidebar" [class.filtros-sidebar--hidden]="!mostrarFiltros">
        <div class="filtros-container">
          
          <!-- Header de Filtros -->
          <div class="filtros-header-control">
            <div class="filtros-icon-wrapper">
              <ion-icon name="filter-outline" class="filtros-icon"></ion-icon>
              <h4 class="filtros-header-titulo">Filtros</h4>
            </div>
            <ion-icon 
              name="chevron-down-outline" 
              class="filtros-toggle-icon"
              [class.filtros-toggle-icon--rotated]="!mostrarFiltros"
              (click)="toggleFiltros()"
            ></ion-icon>
          </div>

          <!-- Tipo de servicio -->
          <div class="filtro-seccion">
            <h5 class="filtro-titulo">Tipo de servicio</h5>
            <ion-list class="filtro-lista">
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="tipoServicioFiltros.comprar"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Comprar</ion-label>
              </ion-item>
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="tipoServicioFiltros.reservar"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Reservar</ion-label>
              </ion-item>
            </ion-list>
          </div>

          <!-- Categor铆a -->
          <div class="filtro-seccion">
            <h5 class="filtro-titulo">Categor铆a</h5>
            <ion-list class="filtro-lista">
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="categoriaFiltros.libros"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Libros</ion-label>
              </ion-item>
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="categoriaFiltros.electronica"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Electr贸nica</ion-label>
              </ion-item>
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="categoriaFiltros.deportes"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Deportes</ion-label>
              </ion-item>
            </ion-list>
          </div>

          <!-- Precio -->
          <div class="filtro-seccion">
            <h5 class="filtro-titulo">Precio</h5>
            <div class="filtro-precio">
              <div class="filtro-precio-valores">
                <span class="filtro-precio-label">{{ formatearRangoPrecio(rangoPrecio.lower) }}</span>
                <span class="filtro-precio-separador">-</span>
                <span class="filtro-precio-label">{{ formatearRangoPrecio(rangoPrecio.upper) }}</span>
              </div>
              <ion-range
                [dualKnobs]="true"
                [min]="precioMin"
                [max]="precioMax"
                [step]="5000"
                [(ngModel)]="rangoPrecio"
                (ionChange)="onRangoPrecioChange($event)"
                class="custom-range"
              ></ion-range>
            </div>
          </div>

          <!-- Campus -->
          <div class="filtro-seccion">
            <h5 class="filtro-titulo">Campus</h5>
            <ion-list class="filtro-lista">
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="campusFiltros.isabelBrown"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Isabel Brown Caces</ion-label>
              </ion-item>
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="campusFiltros.casaCentral"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Casa Central</ion-label>
              </ion-item>
              <ion-item lines="none" class="filtro-item">
                <ion-checkbox 
                  [(ngModel)]="campusFiltros.curauma"
                  (ionChange)="onFiltroChange()"
                  slot="start"
                ></ion-checkbox>
                <ion-label>Curauma</ion-label>
              </ion-item>
            </ion-list>
          </div>

          <!-- Bot贸n Limpiar Filtros -->
          <ion-button 
            expand="block" 
            fill="outline" 
            class="btn-limpiar-filtros"
            (click)="limpiarFiltros()"
          >
            <ion-icon name="close-outline" slot="start"></ion-icon>
            Limpiar filtros
          </ion-button>

        </div>
      </aside>

      <!-- Grid de Productos -->
      <!-- Grid de Productos -->
<main class="productos-main">
  <!-- PRODUCTOS GRID -->
  <div class="productos-grid">
    <div *ngFor="let producto of productosFiltrados" 
         class="producto-item" 
         [routerLink]="['/detalle-producto', producto.id]" 
         style="cursor: pointer">
      
      <ion-card class="producto-card">
        <!-- Imagen del producto -->
        <div class="imagen-container">
          <img [src]="producto.imagen" [alt]="producto.titulo" class="producto-imagen" />
        </div>

        <!-- Informaci贸n del producto -->
        <ion-card-content class="producto-contenido">
          <!-- T铆tulo -->
          <h3 class="titulo">{{ producto.titulo }}</h3>

          <!-- Precio -->
          <div class="precio-section">
            <span class="precio">{{ formatearPrecio(producto.precio) }}</span>
          </div>

          <!-- Descripci贸n corta -->
          <p class="descripcion">{{ producto.descripcion | slice:0:80 }}...</p>

          <!-- Categor铆a y Campus -->
          <div class="meta-info">
            <span class="categoria-badge">{{ producto.categoria }}</span>
            <span class="campus-badge">{{ producto.campus }}</span>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</main>


    </div>

  </div>
</ion-content>