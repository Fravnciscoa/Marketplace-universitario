<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <div class="header-container">
      <!-- Logo -->
      <div class="header-logo">
        <img
          src="assets/icon/Escudo_PUCV-2016__Perfil Redes TW_FB.png"
          alt="PUCV Logo"
        />
        <span class="header-logo-text">MarketPlace</span>
      </div>

      <!-- Navegación -->
      <nav class="header-nav">
        <a routerLink="/home" class="nav-link">Inicio</a>
        <a routerLink="/categorias" class="nav-link">Categorías</a>
        <a routerLink="/carrito" class="nav-link nav-link--active">
          <ion-icon name="cart-outline"></ion-icon>
          Carrito
        </a>
      </nav>

      <!-- Acciones -->
      <div class="header-actions">
        <ng-container *ngIf="!isLoggedIn">
          <ion-button routerLink="/auth" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="log-in-outline"></ion-icon>
            Iniciar Sesión
          </ion-button>
          <ion-button routerLink="/auth" fill="solid" class="btn-auth btn-register">
            Registrarse
          </ion-button>
        </ng-container>

        <ng-container *ngIf="isLoggedIn">
          <ion-button routerLink="/perfil" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="person-outline"></ion-icon>
            Perfil
          </ion-button>
          <ion-button (click)="cerrarSesion()" fill="solid" class="btn-auth btn-logout">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            Cerrar Sesión
          </ion-button>
        </ng-container>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container carrito-container">
    <h1 class="carrito-titulo">Tu carrito</h1>

    <!-- Si está vacío -->
    <div class="carrito-vacio" *ngIf="carrito.length === 0">
      <ion-icon name="cart-outline"></ion-icon>
      <p>Tu carrito está vacío</p>
      <a routerLink="/categorias" class="btn-ir-categorias">Explorar categorías</a>
    </div>

    <!-- Lista de productos -->
    <div class="carrito-lista" *ngIf="carrito.length > 0">
      <ion-card
        class="carrito-item"
        *ngFor="let item of carrito"
      >
        <div class="carrito-item-content">
          <img
            [src]="item.producto.imagen"
            alt="{{ item.producto.titulo }}"
            class="carrito-item-imagen"
          />

          <div class="carrito-item-info">
            <h3>{{ item.producto.titulo }}</h3>
            <p class="carrito-descripcion">{{ item.producto.descripcion }}</p>

            <div class="carrito-precios">
              <span class="carrito-precio-unitario">
                Precio: {{ formatearPrecio(item.producto.precio) }}
              </span>
              <span class="carrito-subtotal">
                Subtotal:
                {{ formatearPrecio(item.producto.precio * item.cantidad) }}
              </span>
            </div>

            <div class="carrito-cantidad">
              <span>Cantidad:</span>
              <div class="carrito-cantidad-controles">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="disminuir(item)"
                >
                  -
                </ion-button>

                <span class="carrito-cantidad-valor">{{ item.cantidad }}</span>

                <ion-button
                  fill="outline"
                  size="small"
                  (click)="aumentar(item)"
                >
                  +
                </ion-button>
              </div>
            </div>
          </div>
        </div>

        <div class="carrito-item-actions">
          <ion-button
            fill="clear"
            class="btn-eliminar"
            (click)="eliminarProducto(item.producto.id)"
          >
            <ion-icon name="trash-outline"></ion-icon>
          </ion-button>
        </div>
      </ion-card>

      <!-- Resumen -->
      <div class="carrito-resumen">
        <p>Total:</p>
        <span>{{ formatearPrecio(total) }}</span>
      </div>

      <div class="carrito-acciones">
        <button class="btn-vaciar" (click)="vaciarCarrito()">Vaciar carrito</button>
        <button class="btn-comprar">Proceder al pago</button>
      </div>
    </div>
  </div>
</ion-content>
