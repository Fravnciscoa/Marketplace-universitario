<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <div class="header-container">
      <!-- Logo -->
      <div class="header-logo">
        <img src="assets/icon/Escudo_PUCV-2016__Perfil Redes TW_FB.png" alt="PUCV Logo" />
        <span class="header-logo-text">MarketPlace</span>
      </div>

      <!-- Navegación -->
      <nav class="header-nav">
        <a routerLink="/home" class="nav-link">Inicio</a>
        <a routerLink="/categorias" class="nav-link">Categorías</a>
        <a routerLink="/carrito" class="nav-link nav-link--active">
          <ion-icon name="cart-outline"></ion-icon>
          Carrito
        </a>
      </nav>

      <!-- Botones de autenticación dinámicos -->
      <div class="header-actions">
        <ng-container *ngIf="!isLoggedIn">
          <ion-button routerLink="/auth" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="log-in-outline"></ion-icon>
            Iniciar Sesión
          </ion-button>
          <ion-button routerLink="/auth" fill="solid" class="btn-auth btn-register">
            Registrarse
          </ion-button>
        </ng-container>
        <ng-container *ngIf="isLoggedIn">
          <ion-button routerLink="/publicar" fill="solid" class="btn-auth btn-publicar">
            <ion-icon slot="start" name="add-outline"></ion-icon>
            Publicar
          </ion-button>
          <ion-button routerLink="/perfil" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="person-outline"></ion-icon>
            Perfil
          </ion-button>
          <ion-button (click)="cerrarSesion()" fill="solid" class="btn-auth btn-logout">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            Cerrar Sesión
          </ion-button>
        </ng-container>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Franja morada -->
  <div class="carrito-hero">
    <div class="carrito-hero-inner">
      <span class="carrito-hero-title">Marketplace Universitario</span>
    </div>
  </div>

  <!-- Layout en dos columnas -->
  <div class="carrito-page">
    <!-- Columna izquierda: lista de productos -->
    <section class="carrito-main">
      <h1 class="carrito-titulo">Carro</h1>
      <p class="carrito-subtitulo">
        Cantidad de productos ({{ carrito.length }})
      </p>
      
      <!-- Carrito vacío -->
      <div *ngIf="carrito.length === 0" class="carrito-vacio">
        <ion-icon name="cart-outline" size="large"></ion-icon>
        <h2>Tu carrito está vacío</h2>
        <ion-button routerLink="/home" color="primary">Ver productos</ion-button>
      </div>
      
      <!-- Lista de productos -->
      <ng-container *ngIf="carrito.length > 0">
        <article class="carrito-item-card" *ngFor="let item of carrito; let i = index">
          <div class="carrito-item">
            <div class="carrito-item-imagen-wrapper">
              <img [src]="item.producto.imagen || 'assets/default-product.png'"
                   [alt]="item.producto.titulo"
                   class="carrito-item-imagen" />
            </div>
            <div class="carrito-item-info">
              <h3 class="carrito-item-titulo">{{ item.producto.titulo }}</h3>
              <p class="carrito-item-precio">{{ formatearPrecio(item.producto.precio || 0) }}</p>
              <div class="carrito-item-cantidad">
                <ion-button size="small" fill="outline" (click)="disminuir(i)">
                  <ion-icon name="remove-outline"></ion-icon>
                </ion-button>
                <span class="cantidad">{{ item.cantidad }}</span>
                <ion-button size="small" fill="outline" (click)="aumentar(i)">
                  <ion-icon name="add-outline"></ion-icon>
                </ion-button>
              </div>
              <p class="carrito-item-subtotal">
                Subtotal: {{ formatearPrecio((item.producto.precio || 0) * item.cantidad) }}
              </p>
            </div>
            <ion-button fill="clear" color="danger" (click)="eliminarProducto(i)" class="carrito-item-eliminar">
              <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
            </ion-button>
          </div>
        </article>
      </ng-container>
    </section>
    
    <!-- Columna derecha: resumen -->
    <aside class="carrito-summary" *ngIf="carrito.length > 0">
      <div class="summary-card">
       <!-- DESPUÉS -->
        <h2 class="summary-title">Resumen de la compra</h2>
        <div class="summary-total-wrapper">
          <span class="summary-total-label">$</span>
          <span class="summary-total-amount">{{ total | number: '1.0-0' }}</span>
        </div>
        <ul class="summary-items">
          <li class="summary-item" *ngFor="let item of carrito">{{ item.producto.titulo }}</li>
        </ul>
        <ion-button expand="block" color="success" size="large" (click)="abrirModalCheckout()">
          CONTINUAR COMPRA
        </ion-button>
        <ion-button expand="block" fill="outline" color="medium" (click)="vaciarCarrito()">
          VACIAR CARRITO
        </ion-button>
      </div>
    </aside>
  </div>
</ion-content>