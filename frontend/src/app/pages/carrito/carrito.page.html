<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <div class="header-container">
      <!-- Logo -->
      <div class="header-logo">
        <img
          src="assets/icon/Escudo_PUCV-2016__Perfil Redes TW_FB.png"
          alt="PUCV Logo"
        />
        <span class="header-logo-text">MarketPlace</span>
      </div>

      <!-- Navegación -->
      <nav class="header-nav">
        <a routerLink="/home" class="nav-link">Inicio</a>
        <a routerLink="/categorias" class="nav-link">Categorías</a>
        <a routerLink="/carrito" class="nav-link nav-link--active">
          <ion-icon name="cart-outline"></ion-icon>
          Carrito
        </a>
      </nav>

      <!-- Acciones -->
      <div class="header-actions">
        <ng-container *ngIf="!isLoggedIn">
          <ion-button routerLink="/auth" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="log-in-outline"></ion-icon>
            Iniciar Sesión
          </ion-button>
          <ion-button routerLink="/auth" fill="solid" class="btn-auth btn-register">
            Registrarse
          </ion-button>
        </ng-container>

        <ng-container *ngIf="isLoggedIn">
          <ion-button routerLink="/perfil" fill="clear" class="btn-auth btn-login">
            <ion-icon slot="start" name="person-outline"></ion-icon>
            Perfil
          </ion-button>
          <ion-button (click)="cerrarSesion()" fill="solid" class="btn-auth btn-logout">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            Cerrar Sesión
          </ion-button>
        </ng-container>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container carrito-container">
    <h1 class="carrito-titulo">Tu carrito</h1>

    <!-- Si está vacío -->
    <ion-content class="ion-padding">
  <!-- Si no hay productos -->
  <div *ngIf="carrito.length === 0" class="carrito-vacio">
    <ion-icon name="cart-outline" size="large"></ion-icon>
    <h2>Tu carrito está vacío</h2>
    <ion-button routerLink="/home" color="primary">
      Ver Productos
    </ion-button>
  </div>

    <!-- Lista de productos -->
    
  <!-- Lista de productos en el carrito -->
  <div *ngIf="carrito.length > 0">
    <!-- ⬅️ AGREGAR: let i = index -->
    <ion-card *ngFor="let item of carrito; let i = index">
      <ion-card-content>
        <div class="carrito-item">
          <!-- Imagen del producto -->
          <img [src]="item.producto.imagen || 'assets/default-product.png'" 
               [alt]="item.producto.titulo"
               class="producto-imagen">

          <!-- Información del producto -->
          <div class="producto-info">
            <h3>{{ item.producto.titulo }}</h3>
            <p class="precio">${{ item.producto.precio | number }}</p>
            
            <!-- Controles de cantidad -->
            <div class="cantidad-controls">
              <ion-button 
                size="small" 
                fill="outline" 
                (click)="disminuir(i)">  <!-- ⬅️ CAMBIAR: usar i -->
                <ion-icon name="remove-outline"></ion-icon>
              </ion-button>
              
              <span class="cantidad">{{ item.cantidad }}</span>
              
              <ion-button 
                size="small" 
                fill="outline" 
                (click)="aumentar(i)">  <!-- ⬅️ CAMBIAR: usar i -->
                <ion-icon name="add-outline"></ion-icon>
              </ion-button>
            </div>

            <!-- Subtotal -->
            <p class="subtotal">
              Subtotal: ${{ (item.producto.precio * item.cantidad) | number }}
            </p>
          </div>

          <!-- Botón eliminar -->
          <ion-button 
            fill="clear" 
            color="danger" 
            (click)="eliminarProducto(i)">  <!-- ⬅️ CAMBIAR: usar i -->
            <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Total y botones de acción -->
    <div class="total-container">
      <h2>Total: ${{ total | number }}</h2>
      
      <!-- Botón para vaciar carrito -->
      <ion-button 
        expand="block" 
        fill="outline" 
        color="danger"
        (click)="vaciarCarrito()">
        <ion-icon slot="start" name="trash-outline"></ion-icon>
        Vaciar Carrito
      </ion-button>

      <!-- Botón para finalizar compra -->
      <ion-button 
        expand="block" 
        color="success" 
        size="large"
        (click)="abrirModalCheckout()">
        <ion-icon slot="start" name="card-outline"></ion-icon>
        Finalizar Compra
      </ion-button>

      <!-- Botón para seguir comprando -->
      <ion-button 
        expand="block" 
        fill="outline" 
        color="primary"
        routerLink="/home">
        <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
        Seguir Comprando
      </ion-button>
    </div>
  </div>
</ion-content>
<!-- Al final del archivo, después de mostrar el total -->
<div class="total-container">
  <h2>Total: ${{ total | number }}</h2>
  
  <!-- Botón para finalizar compra -->
  <ion-button 
    expand="block" 
    color="success" 
    size="large"
    (click)="abrirModalCheckout()"
    [disabled]="carrito.length === 0">
    <ion-icon slot="start" name="card-outline"></ion-icon>
    Finalizar Compra
  </ion-button>

  <!-- Botón para seguir comprando -->
  <ion-button 
    expand="block" 
    fill="outline" 
    color="primary"
    routerLink="/home">
    <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
    Seguir Comprando
  </ion-button>
</div>
