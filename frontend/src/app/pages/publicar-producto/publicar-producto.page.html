<ion-header>
  <!-- Navbar principal -->
  <ion-toolbar class="navbar">
    <!-- Logo + Título -->
    <div class="navbar-brand" slot="start">
      <img src="assets/icon/Escudo_PUCV-2016__Perfil Redes TW_FB.png" alt="Logo PUCV" class="logo" />
      <span class="brand-text">MarketPlace</span>
    </div>

    <!-- Links de navegación (centro) -->
    <div class="nav-links" slot="">
      <a routerLink="/home" class="nav-link">Inicio</a>
      <a routerLink="/categorias" class="nav-link">Categorías</a>
      <a routerLink="/carrito" class="nav-link">
        <ion-icon name="cart-outline"></ion-icon>
        Carrito
      </a>
    </div>

    <!-- Botones de usuario (derecha) -->
    <ion-buttons slot="end" class="user-actions">
      <!-- Botón Perfil -->
      <ion-button *ngIf="isLoggedIn" routerLink="/perfil" class="btn-auth btn-perfil">
        <ion-icon name="person-outline" slot="start"></ion-icon>
        Perfil
      </ion-button>

      <!-- Botón Cerrar Sesión -->
      <ion-button *ngIf="isLoggedIn" (click)="logout()" class="btn-auth btn-logout">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Cerrar Sesión
      </ion-button>

      <!-- Botón Iniciar Sesión (si no está logueado) -->
      <ion-button *ngIf="!isLoggedIn" routerLink="/auth" class="btn-auth btn-login">
        <ion-icon name="log-in-outline" slot="start"></ion-icon>
        Iniciar Sesión
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="form-container">
    
    <!-- Área de imagen -->
    <div class="image-upload-area" (click)="fileInput.click()">
      <img *ngIf="imagenPreview" [src]="imagenPreview" class="image-preview" alt="Preview" />
      <div *ngIf="!imagenPreview" class="upload-placeholder">
        <ion-icon name="camera"></ion-icon>
        <p>Selecciona una imagen</p>
      </div>
      <input #fileInput type="file" accept="image/*" (change)="onImageSelected($event)" />
    </div>

    <!-- Formulario -->
    <ion-item>
      <ion-label position="stacked">Título *</ion-label>
      <ion-input [(ngModel)]="form.titulo" placeholder="Ej: Calculadora Casio FX-570"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Precio (CLP) *</ion-label>
      <ion-input type="number" [(ngModel)]="form.precio" placeholder="0"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Descripción</ion-label>
      <ion-textarea [(ngModel)]="form.descripcion" rows="4" placeholder="Describe tu producto..."></ion-textarea>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Categoría *</ion-label>
      <ion-select [(ngModel)]="form.categoria" placeholder="Selecciona una categoría">
        <ion-select-option *ngFor="let cat of categorias" [value]="cat">
          {{ cat }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Campus *</ion-label>
      <ion-select [(ngModel)]="form.campus" placeholder="Selecciona un campus">
        <ion-select-option *ngFor="let camp of campusList" [value]="camp">
          {{ camp }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Marca</ion-label>
      <ion-input [(ngModel)]="form.marca" placeholder="Ej: Casio"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Modelo</ion-label>
      <ion-input [(ngModel)]="form.modelo" placeholder="Ej: FX-570"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Condición</ion-label>
      <ion-select [(ngModel)]="form.condicion" placeholder="Selecciona la condición">
        <ion-select-option value="Nuevo">Nuevo</ion-select-option>
        <ion-select-option value="Usado - Como nuevo">Usado - Como nuevo</ion-select-option>
        <ion-select-option value="Usado - Buen estado">Usado - Buen estado</ion-select-option>
        <ion-select-option value="Usado - Aceptable">Usado - Aceptable</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Año de Compra</ion-label>
      <ion-input [(ngModel)]="form.ano_compra" type="number" placeholder="Ej: 2023"></ion-input>
    </ion-item>

    <!-- Botón publicar -->
    <ion-button expand="block" class="btn-publicar" (click)="guardar()">
      <ion-icon name="save-outline" slot="start"></ion-icon>
      {{ modoEdicion ? 'ACTUALIZAR' : 'PUBLICAR' }}
    </ion-button>

  </div>
</ion-content>

<!-- Toast de notificaciones -->
<ion-toast
  [isOpen]="showToast"
  [message]="toastMessage"
  [duration]="2500"
  (didDismiss)="showToast = false"
></ion-toast>
